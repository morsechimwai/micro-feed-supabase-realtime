# MicroFeed with Realtime CRUD (React + Supabase)

แพลตฟอร์ม microfeed ที่สร้างด้วย React, TypeScript และ Supabase เพื่อให้ผู้ใช้เผยแพร่ แก้ไข และลบโพสต์ได้แบบเรียลไทม์ พร้อมระบบยืนยันตัวตนและการปรับธีม

<!-- ![MicroFeed Screenshot](./public/preview.png)
Live Demo: [https://react-supabase-realtime-tasks.vercel.app](https://react-supabase-realtime-tasks.vercel.app/) -->

## Feature
- จัดการโพสต์ครบวงจร: เพิ่ม แก้ไข (ผ่าน dialog) และลบโพสต์ พร้อมตรวจสอบข้อมูลด้วย Zod
- แนบรูปประกอบโพสต์: อัปโหลดภาพไปยัง Supabase Storage พร้อมแสดงตัวอย่าง, แก้ไขภาพทับไฟล์เดิม และลบภาพออกจาก Storage เมื่อเอาโพสต์ลง
- ซิงก์เรียลไทม์: รับการเปลี่ยนแปลงจาก Supabase ผ่านช่องทาง `postgres_changes`
- ระบบยืนยันตัวตน Supabase Auth สำหรับลงชื่อเข้าใช้/ออก
- แสดงเวลาโพสต์ด้วย Day.js ทั้งแบบ relative เวลาใกล้ปัจจุบันและรูปแบบวันที่
- ปรับธีม Light/Dark และบันทึกค่าไว้ใน Local Storage

## Quick Start
1. ติดตั้ง Node.js เวอร์ชัน 18 ขึ้นไป
2. โคลนโปรเจกต์และติดตั้งแพ็กเกจ
   ```bash
   git clone <repository-url>
   cd react-supabase-lab
   npm install
   ```
3. สร้างไฟล์ `.env.local` หรือกำหนดตัวแปรแวดล้อมตามหัวข้อ Environment Variables
4. เริ่มพัฒนา
   ```bash
   npm run dev
   ```
5. เปิดเบราว์เซอร์ที่ `http://localhost:5173`

### Supabase Setup (Auth + Storage)
1. สร้าง Supabase Project และเปิดการใช้งาน Authentication (Email)
   
2. สร้างตาราง `tasks` ด้วยโครงสร้างตัวอย่าง:
   ```sql
   create table if not exists public.tasks (
     id bigint generated by default as identity primary key,
     title text not null,
     description text,
     email text not null,
     created_at timestamp with time zone default timezone('utc' :: text, now()) not null
   );
   ```
   
3. เปิด RLS และเพิ่ม Policy สำหรับการเข้าถึงของผู้ใช้ที่ลงชื่อเข้าใช้:
   ```sql
   alter table public.tasks enable row level security;

   create policy "Enable read access for authenticated users"
     on public.tasks for select using (auth.uid() is not null);

   create policy "Enable insert access for authenticated users"
     on public.tasks for insert with check (auth.uid() is not null);

    create policy "Enable update access for owners"
      on public.tasks for update using (email = auth.jwt() ->> 'email');

    create policy "Enable delete access for owners"
      on public.tasks for delete using (email = auth.jwt() ->> 'email');
   ```

4. สร้าง Storage bucket สำหรับเก็บภาพ เช่น `tasks-images` (ตั้งค่า public = false เพื่อให้เข้าถึงผ่าน policy)
   
5. เพิ่ม Storage Policy เพื่อให้อ่านได้สาธารณะ แต่จำกัดการแก้ไขเฉพาะผู้ใช้ที่ยืนยันตัวตน:
   ```sql
   -- เปิดใช้งาน RLS (เปิดอัตโนมัติเมื่อสร้าง bucket ใหม่)
   create policy "Public read access"
     on storage.objects for select
     using (bucket_id = 'tasks-images');

   create policy "Authenticated upload"
     on storage.objects for insert
     with check (bucket_id = 'tasks-images' and auth.role() = 'authenticated');

   create policy "Update own uploads"
     on storage.objects for update
     using (bucket_id = 'tasks-images' and auth.role() = 'authenticated');

   create policy "Delete own uploads"
     on storage.objects for delete
     using (bucket_id = 'tasks-images' and auth.role() = 'authenticated');
   ```
   > หมายเหตุ: ถ้าต้องการจำกัดให้แก้ไขได้เฉพาะไฟล์ของตัวเอง ให้ปรับ policy ให้ตรวจสอบ `owner` ผ่าน metadata หรือโครงสร้างเพิ่มเติมตามความต้องการ

6. ตั้งค่าตัวแปรแวดล้อม `VITE_SUPABASE_URL` และ `VITE_SUPABASE_KEY` เป็นค่า anon key (Public)

## Environment Variables
ตั้งค่าตัวแปรต่อไปนี้ใน `.env.local`
- `VITE_SUPABASE_URL` : URL ของ Supabase Project
- `VITE_SUPABASE_KEY` : API Key (แนะนำให้ใช้ anon key สำหรับฝั่ง client)

## NodeJS Libraries
- `react`, `react-dom` : สร้าง UI หลักของแอป
- `vite`, `@vitejs/plugin-react` : Dev server และกระบวนการ build ความเร็วสูง
- `@supabase/supabase-js` : ติดต่อฐานข้อมูลและระบบ auth ของ Supabase
- `react-hook-form`, `@hookform/resolvers`, `zod` : จัดการฟอร์มและ validate ข้อมูล
- `dayjs` และปลั๊กอิน `relativeTime` : จัดรูปแบบเวลาและข้อความแบบ human-readable
- `lucide-react`, `tailwindcss` : ชุดไอคอนและระบบสไตล์
- อ้างอิงเพิ่มเติมจาก Supabase Docs:
- [Realtime Documentation](https://supabase.com/docs/guides/realtime)
- [Authentication Overview](https://supabase.com/docs/guides/auth)

## License [**MIT**](./LICENSE)
